<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.13">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Eval - simplifying agent versioning and evaluation – StringDALE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ac077c1e730dfeb5e42400639d17284e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Eval - simplifying agent versioning and evaluation – StringDALE">
<meta property="og:description" content="String Diagram Agent Language Express (StringDALE) is a language for building LLM agents using string diagrams.">
<meta property="og:image" content="https://DeanLight.github.io/StringDALE/docs/tutorials/010_evaluation_files/figure-html/cell-3-output-1.svg">
<meta property="og:site_name" content="StringDALE">
<meta name="twitter:title" content="Eval - simplifying agent versioning and evaluation – StringDALE">
<meta name="twitter:description" content="String Diagram Agent Language Express (StringDALE) is a language for building LLM agents using string diagrams.">
<meta name="twitter:image" content="https://DeanLight.github.io/StringDALE/docs/tutorials/010_evaluation_files/figure-html/cell-3-output-1.svg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">StringDALE</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/tutorials/getting_started.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/examples/001_rag.html"> 
<span class="menu-text">Examples</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/reference/diagrams.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DeanLight/stringdale"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/tutorials/getting_started.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../../docs/tutorials/evaluation.html">Evaluation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hello world</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/port_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Port Mapping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/decision_diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision Diagrams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/nested_diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nested Diagrams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/compound_diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compound Diagrams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/customizing_state.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customizing State</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/stateful_nodes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stateful Nodes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/batching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Batching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/keeping_diagrams_dry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Keeping Diagrams DRY</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/evaluation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Evaluation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/examples/001_rag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAG</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/examples/002_react.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">React</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/examples/003_interactive_qa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactive QA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/examples/rag_on_summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAG on summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/examples/interactive_qa_db.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactive QA with DB</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/examples/monitor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monitor Pattern</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/examples/router.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Routing Pattern</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Reference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/diagrams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diagrams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/chat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chat</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/dbs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DBs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/eval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Eval</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">TLDR</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#concepts" id="toc-concepts" class="nav-link" data-scroll-target="#concepts">Concepts</a></li>
  <li><a href="#testing-a-single-workflow" id="toc-testing-a-single-workflow" class="nav-link" data-scroll-target="#testing-a-single-workflow">Testing a single workflow</a>
  <ul class="collapse">
  <li><a href="#basic-flow" id="toc-basic-flow" class="nav-link" data-scroll-target="#basic-flow">Basic Flow</a></li>
  </ul></li>
  <li><a href="#available-eval-functions" id="toc-available-eval-functions" class="nav-link" data-scroll-target="#available-eval-functions">Available Eval Functions</a></li>
  <li><a href="#adding-your-own-eval-functions" id="toc-adding-your-own-eval-functions" class="nav-link" data-scroll-target="#adding-your-own-eval-functions">Adding your own Eval functions</a></li>
  <li><a href="#workflow-versioning" id="toc-workflow-versioning" class="nav-link" data-scroll-target="#workflow-versioning">Workflow Versioning</a>
  <ul class="collapse">
  <li><a href="#making-our-agent-configurable" id="toc-making-our-agent-configurable" class="nav-link" data-scroll-target="#making-our-agent-configurable">Making our agent configurable</a></li>
  <li><a href="#comparing-versions" id="toc-comparing-versions" class="nav-link" data-scroll-target="#comparing-versions">Comparing versions</a></li>
  </ul></li>
  <li><a href="#complex-trace-dependencies" id="toc-complex-trace-dependencies" class="nav-link" data-scroll-target="#complex-trace-dependencies">Complex trace dependencies</a></li>
  <li><a href="#debugging-test-cases" id="toc-debugging-test-cases" class="nav-link" data-scroll-target="#debugging-test-cases">Debugging test cases</a></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics">Advanced Topics</a>
  <ul class="collapse">
  <li><a href="#avoiding-unnecessary-comparisons" id="toc-avoiding-unnecessary-comparisons" class="nav-link" data-scroll-target="#avoiding-unnecessary-comparisons">Avoiding unnecessary comparisons</a></li>
  <li><a href="#limiting-api-call-rate" id="toc-limiting-api-call-rate" class="nav-link" data-scroll-target="#limiting-api-call-rate">Limiting api call rate</a></li>
  <li><a href="#training-and-validation-sets" id="toc-training-and-validation-sets" class="nav-link" data-scroll-target="#training-and-validation-sets">Training and validation sets</a></li>
  <li><a href="#eval-behind-the-scenes" id="toc-eval-behind-the-scenes" class="nav-link" data-scroll-target="#eval-behind-the-scenes">Eval behind the scenes</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/DeanLight/StringDALE/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/tutorials/getting_started.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../../docs/tutorials/evaluation.html">Evaluation</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Eval - simplifying agent versioning and evaluation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>Note: Eval is still in early development, expect breaking changes between versions</p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TLDR</h2>
<p><code>stringdale.eval</code> is a module that enables you to</p>
<ul>
<li>specify expected behavior of complex workflows via yaml <code>TestCase</code> files</li>
<li>evaluate how well workflows adhere to the expected behavior</li>
<li>detect performance drifts between versions of agentic workflows</li>
</ul>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>The need: Current evaluation systems for LLM agents have several shortcomings:</p>
<ul>
<li>They are often limited to simple tool calling agents
<ul>
<li>allowing specification of expected outputs and tools</li>
</ul></li>
<li>They require too much boilerplate for adding custom comparison logic
<ul>
<li>Which is crucial in agentic workflows, since each task can have different senses of similarity to expected output</li>
</ul></li>
</ul>
<p>Overview of features:</p>
<ul>
<li>A yaml DSL that allows you to define expected behaviors of a partial subset of workflow traces</li>
<li>Uses port mapping to evaluate sub objects of node output</li>
<li>Easy to define custom printing logic</li>
<li>Can define partial order of expected traces, allowing support for parallel events or unknown order of events.</li>
<li>Automates away boiler plate of detecting differences between different version of an agent
<ul>
<li>Simple agent versioning is already supported by <code>stringdale</code> best practices.</li>
</ul></li>
<li>Easy to read pretty prints of eval diffs, improve velocity of tuning agentic workflows</li>
</ul>
</section>
<section id="concepts" class="level2">
<h2 class="anchored" data-anchor-id="concepts">Concepts</h2>
<p>Bellow is a glossary of concepts used in the <code>eval</code> framework:</p>
<section id="trace-nodes-test-nodes" class="level4">
<h4 class="anchored" data-anchor-id="trace-nodes-test-nodes">Trace Nodes, Test Nodes</h4>
<p>Each trace in a stringdale workflows comes from the execution of a node of some diagram/subdiagram These trace nodes are identified by the name of the node that generated them.</p>
<p>In the context of <code>eval</code>, a test node specifies a set of conditions that are evaluated for each trace node whose name fits the a name regex of the test node.</p>
</section>
<section id="condition" class="level4">
<h4 class="anchored" data-anchor-id="condition">Condition</h4>
<p>A test that is run on the output of a node. Since workflows are not deterministic, a condition describes how much <code>distance</code> there is between the actual and expected output of a node.</p>
</section>
<section id="test-case" class="level4">
<h4 class="anchored" data-anchor-id="test-case">Test Case</h4>
<p>A specification of expected behavior of a single run of a workflow over some input.</p>
<ul>
<li><p>Consists of</p>
<ul>
<li>The diagram input</li>
<li>A list of TestNodes</li>
<li>Each test nodes has a list of Conditions</li>
</ul></li>
<li><p>Written by a user in a yaml file.</p></li>
</ul>
</section>
<section id="trace-log" class="level4">
<h4 class="anchored" data-anchor-id="trace-log">Trace Log</h4>
<p>A log file of traces of a diagram. Contains at least:</p>
<ul>
<li>Node names - to allow searching node names by patterns</li>
<li>Outputs - to allow running conditions on them</li>
</ul>
</section>
<section id="test-run-result" class="level4">
<h4 class="anchored" data-anchor-id="test-run-result">Test Run Result</h4>
<p>An evaluation of how well a single agent matched a test case’s test nodes when run on the test case’s input. Includes best matching (alignment) between test nodes and nodes. Includes the <code>distance</code> accrued in each condition between the expected output and the actual output of the trace.</p>
</section>
<section id="test-set" class="level4">
<h4 class="anchored" data-anchor-id="test-set">Test Set</h4>
<p>A set of Test Cases, over which an agentic workflow is evaluated over.</p>
</section>
<section id="comparison" class="level4">
<h4 class="anchored" data-anchor-id="comparison">Comparison</h4>
<p>A comparison between both the distance and alignment of two different agent across all test cases in a test set</p>
</section>
</section>
<section id="testing-a-single-workflow" class="level2">
<h2 class="anchored" data-anchor-id="testing-a-single-workflow">Testing a single workflow</h2>
<section id="basic-flow" class="level3">
<h3 class="anchored" data-anchor-id="basic-flow">Basic Flow</h3>
<p>Let us remember our <code>ReactAgent</code> from the decision diagram tutorial.</p>
<div id="cell-11" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.core <span class="im">import</span> get_git_root</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.doc <span class="im">import</span> pprint_yaml</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.examples.react <span class="im">import</span> ReactAgent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-12" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ReactAgent.draw()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="010_evaluation_files/figure-html/cell-3-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can specify that we would like it to find the square of obama age using at least two tool calls.</p>
<ul>
<li>One that looks up Obama on wikipedia</li>
<li>The second, that happens later, that computes obama’s age</li>
</ul>
<p>We can express this expectation in the following TestCase:</p>
<div id="cell-14" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>test_case_dir <span class="op">=</span> get_git_root()<span class="op">/</span><span class="st">'sample_data'</span><span class="op">/</span><span class="st">'eval'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>log_dir <span class="op">=</span> get_git_root()<span class="op">/</span><span class="st">'logs'</span><span class="op">/</span><span class="st">'eval'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>obama_test_case <span class="op">=</span> test_case_dir<span class="op">/</span><span class="st">'obama.yaml'</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pprint_yaml(obama_test_case, style<span class="op">=</span><span class="st">'native'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[{</span><span class="s">"role"</span><span class="p p-Indicator">:</span><span class="s">"user"</span><span class="p p-Indicator">,</span><span class="s">"content"</span><span class="p p-Indicator">:</span><span class="s">"Question:</span><span class="nv"> </span><span class="s">what</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">obamas</span><span class="nv"> </span><span class="s">age</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">power</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">2?"</span><span class="p p-Indicator">}]</span>
<span class="nt">test_nodes</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># looks for nodes whose name matches the regex "use_tool"</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">use_tool</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># checks that output.content.name is "wikipedia_search" using string equality</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.name</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"wikipedia_search"</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="s">"eq"</span>
<span class="w">      </span><span class="c1"># checks that output.content.input.q is close to "Obama" using cosine similarity</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.input.q</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"Obama"</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">use_tool</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.name</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run_python_code</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eq</span>
<span class="w">      </span><span class="c1"># Evaluates a pythonic expression to ensure the output is between 60 and 65 (Obama's age at the time of writing)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.output</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"({0}</span><span class="nv"> </span><span class="s">&lt;</span><span class="nv"> </span><span class="s">65)</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">({0}</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">60)"</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="s">"eval"</span>


<span class="w">  </span>
</pre></div>
</div>
</div>
<p>Note that our yaml has 2 top level keys, “inputs” and “test_nodes”. The inputs we will feed into the diagram until it reaches the End or we run out of inputs. In the case of diagrams without breakpoints, they will finish after a single input is fed.</p>
<p>The “test_nodes” key contains a list of Test Nodes, which in turn contain conditions for us to evaluate by several eval functions. By default, <code>eval</code> uses a “distance” version of cosine similarity, which compares strings.</p>
<p>Now, to run the evaluation, we can use the <code>eval_single</code> function.</p>
<div id="cell-17" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.<span class="bu">eval</span> <span class="im">import</span> eval_single</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-18" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># eval single returns both the path to the log file and the dataframe of the test run</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>test_run,log_path <span class="op">=</span> <span class="cf">await</span> eval_single(ReactAgent,obama_test_case,log_dir<span class="op">=</span>log_dir)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>log_path.relative_to(get_git_root())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Path('logs/eval/obama.log.yaml')</code></pre>
</div>
</div>
<div id="cell-19" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>test_run</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">datapoint</th>
<th data-quarto-table-cell-role="th">node_label</th>
<th data-quarto-table-cell-role="th">trace_idx</th>
<th data-quarto-table-cell-role="th">func</th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">actual</th>
<th data-quarto-table-cell-role="th">expected</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">node_idx</th>
<th data-quarto-table-cell-role="th">trace_name</th>
<th data-quarto-table-cell-role="th">node_name</th>
<th data-quarto-table-cell-role="th">kwargs</th>
<th data-quarto-table-cell-role="th">aggregation</th>
<th data-quarto-table-cell-role="th">agg_meta</th>
<th data-quarto-table-cell-role="th">per_node_comp_id</th>
<th data-quarto-table-cell-role="th">comp_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>anonymous</td>
<td>0</td>
<td>1</td>
<td>eq</td>
<td>content.name</td>
<td>wikipedia_search</td>
<td>wikipedia_search</td>
<td>0.00000</td>
<td>0</td>
<td>use_tool</td>
<td>use_tool</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>anonymous</td>
<td>0</td>
<td>1</td>
<td>cosine_dist</td>
<td>content.input.q</td>
<td>Barack Obama</td>
<td>Obama</td>
<td>0.32372</td>
<td>0</td>
<td>use_tool</td>
<td>use_tool</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>anonymous</td>
<td>1</td>
<td>4</td>
<td>eq</td>
<td>content.name</td>
<td>run_python_code</td>
<td>run_python_code</td>
<td>0.00000</td>
<td>1</td>
<td>use_tool</td>
<td>use_tool</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>anonymous</td>
<td>1</td>
<td>4</td>
<td>eval</td>
<td>content.output</td>
<td>64</td>
<td>({0} &lt; 65) &amp; ({0} &gt; 60)</td>
<td>0.00000</td>
<td>1</td>
<td>use_tool</td>
<td>use_tool</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The first return value is dataframe that contains metadata for each of our comparisons, including:</p>
<ul>
<li>node_label - Which node it belongs to</li>
<li>trace_idx - which trace each node mapped to</li>
<li>func - The evaluation function used for comparison (e.g.&nbsp;eq, eval, chat_eval)</li>
<li>key - The path to extract the value to compare from the trace</li>
<li>actual - The actual value from the trace</li>
<li>expected - The expected value from the test case</li>
<li>distance - The computed distance between actual and expected (0 = perfect match)</li>
</ul>
</section>
</section>
<section id="available-eval-functions" class="level2">
<h2 class="anchored" data-anchor-id="available-eval-functions">Available Eval Functions</h2>
<p>A default eval function is used when you don’t specify an eval function for a given node.</p>
<p>Stringdale provides several built-in evaluation functions for comparing outputs with expected values. Each function returns a distance score where:</p>
<ul>
<li>0 indicates a perfect match</li>
<li>Higher values indicate greater differences</li>
<li><code>np.inf</code> indicates a mismatch</li>
</ul>
<p>Here are the built in functions:</p>
<div id="cell-24" class="cell">
<div class="cell-output cell-output-display">
<pre><code>{'eq': 'eq',
 'eval': 'safe_eval',
 'chat_eval': 'chat_eval',
 'cosine_dist': 'cosine_dist',
 'any': 'eval_any'}</code></pre>
</div>
</div>
<p>For more information about these functions, see the eval reference section.</p>
</section>
<section id="adding-your-own-eval-functions" class="level2">
<h2 class="anchored" data-anchor-id="adding-your-own-eval-functions">Adding your own Eval functions</h2>
<p>An eval function is a function (sync or async) that expects:</p>
<ul>
<li>The first positional output to be the result from the agent</li>
<li>The second positional output to be the expected output from the TestCase</li>
<li>Any number of kwargs</li>
</ul>
<div id="cell-28" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-29" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> word_count(out:<span class="bu">str</span>,expected:<span class="bu">int</span>,<span class="bu">abs</span><span class="op">=</span><span class="va">True</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(out,<span class="bu">str</span>):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.inf</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> math.<span class="bu">abs</span>(<span class="bu">len</span>(out.split()) <span class="op">-</span> expected)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(out.split()) <span class="op">-</span> expected</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To add your own custom eval functions:</p>
<div id="cell-31" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> <span class="cf">await</span> eval_single(ReactAgent,obama_test_case,log_dir<span class="op">=</span>log_dir,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pass additional custom eval functions as a dict</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    eval_funcs<span class="op">=</span>{<span class="st">'word_count'</span>:word_count},</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># you can also override which eval function is used by default</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># by passing the `default_eval_func` kwarg the name of the function</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># default_func='word_count'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="workflow-versioning" class="level2">
<h2 class="anchored" data-anchor-id="workflow-versioning">Workflow Versioning</h2>
<p>The true power of specifying test cases, is to make it easier to check if our workflow improves as we make changes to it, Including:</p>
<ul>
<li>Configure prompts</li>
<li>Add better context data</li>
<li>And make sub workflows more adaptive</li>
</ul>
<p>The main entry point of the eval module, named <code>eval</code> takes several versions of an agent and compares their performance on a set of test cases.</p>
<p>In order to use it, we need to be able to generate multiple versions of our agents with ease. Therefore, in this section we will 1. See how to use stringdale best practices to make our agent’s easily configurable 2. See how to call <code>eval</code> on a set of agents and test cases.</p>
<section id="making-our-agent-configurable" class="level3">
<h3 class="anchored" data-anchor-id="making-our-agent-configurable">Making our agent configurable</h3>
<p>We will use the RAG example from the <code>Hello World</code> tutorial. However, following the <code>Keeping Diagrams DRY</code> tutorial, we made our using a factory pattern.</p>
<div id="cell-36" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.examples.rag <span class="im">import</span> RagFactory</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.db <span class="im">import</span> ChromaClient</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Using the factory pattern, we can delegate all configuration to configuration files, version them, and invoke our factory to create different versions of our agents with ease.</p>
<div id="cell-38" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_agent(conf_dir: Path):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    agent_yaml_path <span class="op">=</span> conf_dir <span class="op">/</span> <span class="st">'agent.yml'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    vec_db_yaml_path <span class="op">=</span> conf_dir <span class="op">/</span> <span class="st">'vec_db.yml'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    agent_conf <span class="op">=</span> yaml.safe_load(agent_yaml_path.read_text())</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    vec_db_conf <span class="op">=</span> yaml.safe_load(vec_db_yaml_path.read_text())</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> ChromaClient(persist_path<span class="op">=</span>tempfile.mkdtemp())</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> collection_name, docs <span class="kw">in</span> vec_db_conf.items():</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        db.add_collection(collection_name, exists_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        db.upsert(collection_name, docs)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    agent_conf[<span class="st">'db'</span>] <span class="op">=</span> db</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    Agent <span class="op">=</span> RagFactory(<span class="op">**</span>agent_conf)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Agent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-39" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dataset_dir <span class="op">=</span> get_git_root()<span class="op">/</span><span class="st">'sample_data'</span><span class="op">/</span><span class="st">'eval_datasets'</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>agent_config_dir <span class="op">=</span> dataset_dir<span class="op">/</span><span class="st">'agent_configs'</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> tree {agent_config_dir} <span class="op">--</span>noreport <span class="op">|</span> tail <span class="op">-</span>n <span class="op">+</span><span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>├── v001
│&nbsp;&nbsp; ├── agent.yml
│&nbsp;&nbsp; └── vec_db.yml
├── v002
│&nbsp;&nbsp; ├── agent.yml
│&nbsp;&nbsp; └── vec_db.yml
└── v003
    ├── agent.yml
    └── vec_db.yml</code></pre>
</div>
</div>
<p>Let us look at these files</p>
<div id="cell-41" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> version <span class="kw">in</span> <span class="bu">sorted</span>(agent_config_dir.glob(<span class="st">'*'</span>)):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(version.relative_to(agent_config_dir))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'vec_db.yml:'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    pprint_yaml(version<span class="op">/</span><span class="st">'vec_db.yml'</span>,style<span class="op">=</span><span class="st">'native'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'agent.yml:'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    pprint_yaml(version<span class="op">/</span><span class="st">'agent.yml'</span>,style<span class="op">=</span><span class="st">'native'</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'-'</span><span class="op">*</span><span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>v001
vec_db.yml:</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">dog_docs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog1</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The Golden Retriever is a friendly, intelligent breed known for its golden coat. They make excellent family pets and are great with children.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Golden Retriever</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog2</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">German Shepherds are loyal, protective dogs often used in police work. They are highly trainable and good at various tasks.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">German Shepherd</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog3</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The Golden Retriever is a friendly, intelligent breed with a beautiful golden coat. They are wonderful family pets that get along well with kids.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Golden Retriever</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog4</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Huskies are energetic working dogs bred for cold climates. They have thick fur and often blue eyes.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Husky</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog5</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Siberian Huskies are active working dogs that thrive in cold weather. They are known for their thick coats and striking blue eyes.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Husky</span>
</pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>agent.yml:</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">You are a helpful assistant that answers questions about dogs.</span>
<span class="w">  </span><span class="no">I found the following documents that may be relevant to the user's question:</span>
<span class="w">  </span><span class="no">{% for doc in docs %}</span>
<span class="w">  </span><span class="no">{{doc['text']}}</span>
<span class="w">  </span><span class="no">{% endfor %}</span>
<span class="w">  </span><span class="no">Please answer the question based on the documents.</span>

<span class="nt">collection_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog_docs</span>
<span class="nt">k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>----------------------------------------------------------------------------------------------------
v002
vec_db.yml:</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">dog_docs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog1</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The Golden Retriever is a friendly, intelligent breed known for its golden coat. They make excellent family pets and are great with children.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Golden Retriever</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog2</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">German Shepherds are loyal, protective dogs often used in police work. They are highly trainable and good at various tasks.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">German Shepherd</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog3</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The Golden Retriever is a friendly, intelligent breed with a beautiful golden coat. They are wonderful family pets that get along well with kids.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Golden Retriever</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog4</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Huskies are energetic working dogs bred for cold climates. They have thick fur and often blue eyes.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Husky</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog5</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Siberian Huskies are active working dogs that thrive in cold weather. They are known for their thick coats and striking blue eyes.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Husky</span>
</pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>agent.yml:</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">You are a helpful assistant that answers questions about dogs.</span>
<span class="w">  </span><span class="no">Please answer the question based on the documents. Focus on information</span>
<span class="w">  </span><span class="no">about the relationship between dogs and kids. Mention the fur and how soft it is.</span>

<span class="w">  </span><span class="no">I found the following documents that may be relevant to the user's question:</span>
<span class="w">  </span><span class="no">{% for doc in docs %}</span>
<span class="w">  </span><span class="no">{{doc['text']}}</span>
<span class="w">  </span><span class="no">{% endfor %}</span>

<span class="nt">collection_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog_docs</span>
<span class="nt">k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>----------------------------------------------------------------------------------------------------
v003
vec_db.yml:</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">dog_docs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog1</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The Golden Retriever is a friendly, intelligent breed known for its golden coat. They make excellent family pets and are great with children.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Golden Retriever</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog2</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">German Shepherds are loyal, protective dogs often used in police work. They are highly trainable and good at various tasks.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">German Shepherd</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog3</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The Golden Retriever is a friendly, intelligent breed with a beautiful golden coat. They are wonderful family pets that get along well with kids.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Golden Retriever</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog4</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Huskies are energetic working dogs bred for cold climates. They have thick fur and often blue eyes.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Husky</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog5</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Siberian Huskies are active working dogs that thrive in cold weather. They are known for their thick coats and striking blue eyes.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Husky</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pikachus</span>
<span class="w">  </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pikachus are dangerous creatures that smoke tons of cigarettes and scare children.</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">breed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pikachu</span>
</pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>agent.yml:</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">You are a helpful assistant that answers questions about dogs.</span>
<span class="w">  </span><span class="no">I found the following documents that may be relevant to the user's question:</span>
<span class="w">  </span><span class="no">{% for doc in docs %}</span>
<span class="w">  </span><span class="no">{{doc['text']}}</span>
<span class="w">  </span><span class="no">{% endfor %}</span>
<span class="w">  </span><span class="no">Please answer the question based on the documents.</span>

<span class="nt">collection_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog_docs</span>
<span class="nt">k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>----------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>As you can see, our agent contains some context about dogs.</p>
<p>In version 2, we changed the prompt to ask for a list in markdown.</p>
<p>In version 3, we added a document about pikachus</p>
<p>Now, we can load all of these agents using our load_agent function.</p>
<div id="cell-43" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>versions <span class="op">=</span> <span class="bu">sorted</span>([p.name <span class="cf">for</span> p <span class="kw">in</span> agent_config_dir.glob(<span class="st">'*'</span>)])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>agents <span class="op">=</span> {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    version:load_agent(agent_config_dir<span class="op">/</span>version)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> version <span class="kw">in</span> versions</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>agents</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'v001': &lt;stringdale.base.DiagramSchema RAG Agent @0x110c46030&gt;,
 'v002': &lt;stringdale.base.DiagramSchema RAG Agent @0x110c45700&gt;,
 'v003': &lt;stringdale.base.DiagramSchema RAG Agent @0x110c47f80&gt;}</code></pre>
</div>
</div>
</section>
<section id="comparing-versions" class="level3">
<h3 class="anchored" data-anchor-id="comparing-versions">Comparing versions</h3>
<p>First let us make some testcases</p>
<div id="cell-46" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test_case_dir <span class="op">=</span> dataset_dir<span class="op">/</span><span class="st">'test_cases'</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> test_case_dir.glob(<span class="st">'*.yaml'</span>):</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">file</span>.relative_to(test_case_dir))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    pprint_yaml(<span class="bu">file</span>,style<span class="op">=</span><span class="st">'native'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>pikachus.yaml</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tell me about pikachus</span>

<span class="nt">test_nodes</span><span class="p">:</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">They are:</span>
<span class="w">            </span><span class="no">* dangerous</span>
<span class="w">            </span><span class="no">* smoke cigarettes</span>
</pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>goldens.yaml</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tell me about golden retrievers</span>

<span class="nt">test_nodes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">get_docs</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># this condition is used to make sure we retrieved the correct documents</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.[].text</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"The</span><span class="nv"> </span><span class="s">Golden</span><span class="nv"> </span><span class="s">Retriever</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">friendly,</span><span class="nv"> </span><span class="s">intelligent</span><span class="nv"> </span><span class="s">breed</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">beautiful</span><span class="nv"> </span><span class="s">golden</span><span class="nv"> </span><span class="s">coat."</span>
<span class="w">        </span><span class="c1"># we can use the aggregation key to instruct eval to evaluate the condition across all elements in a list</span>
<span class="w">        </span><span class="c1"># and aggregate the results</span>
<span class="w">        </span><span class="c1"># aggregation can be min, max, sum, avg</span>
<span class="w">        </span><span class="nt">aggregation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">min</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">They are great with kids.</span>
<span class="w">          </span><span class="no">And their fur is so incredibly soft.</span>
</pre></div>
</div>
</div>
<p>Now we can finally use <code>eval</code> the main entry point of our module</p>
<div id="cell-48" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.<span class="bu">eval</span> <span class="im">import</span> <span class="bu">eval</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-49" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>out_dir<span class="op">=</span>get_git_root()<span class="op">/</span><span class="st">'logs'</span><span class="op">/</span><span class="st">'eval_results'</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>eval_res <span class="op">=</span> <span class="cf">await</span> <span class="bu">eval</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    test_dir<span class="op">=</span>test_case_dir, <span class="co"># where to find the test cases</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    out_dir<span class="op">=</span>out_dir, <span class="co"># where to save the results</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    agents<span class="op">=</span>agents, <span class="co"># a dict of agents to compare</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    base_agent<span class="op">=</span><span class="st">'v001'</span>, <span class="co"># the version to compare against, must be a key in the agents dict</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Summary of runs:                                                                                                   
    <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span>                                                                                                           
    Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.78</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.61</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04</span>                                                                        
    <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span>                                                                                                           
    Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.73</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.58</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04</span>                                                                        
    <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span>                                                                                                           
    Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.63</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.46</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04</span>                                                                        
Summary of comparisons:                                                                                            
    <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> vs <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span>:                                                                                                  
      improved <span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">)</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">goldens</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.11</span><span style="font-weight: bold">)</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">pikachus</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00</span><span style="font-weight: bold">)</span>,                                                                
    <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> vs <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span>:                                                                                                  
      improved <span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">pikachus</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.30</span><span style="font-weight: bold">)</span>,                                                                               
Datapoints:                                                                                                        
    <span style="color: #af00ff; text-decoration-color: #af00ff">pikachus</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../sample_data/eval_datasets/test_cases/pikachus.yaml</span>                                         
      summary:                                                                                                     
        <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03</span>                                                             
        <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03</span>                                                             
        <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.57</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.57</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03</span>                                                             
        <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> vs <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span>: Alignment change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold; font-style: italic">False</span> Score change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">improved</span> Score by: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00</span>                                
        <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> vs <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span>: Alignment change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold; font-style: italic">False</span> Score change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">improved</span> Score by: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.30</span>                                
      logs:                                                                                                        
        <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v001/logs/pikachus.log.yaml</span>                                         
        <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v002/logs/pikachus.log.yaml</span>                                         
        <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v003/logs/pikachus.log.yaml</span>                                         
      details:                                                                                                     
        Comparison #<span style="color: #008000; text-decoration-color: #008000; font-weight: bold">0</span>, node_pattern: <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span>, key: <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">content</span>, func:                                                     
        expected:                                                                                                  
    <span style="color: #ce9178; text-decoration-color: #ce9178">        They are:</span>                                                                                              
    <span style="color: #ce9178; text-decoration-color: #ce9178">          * dangerous</span>                                                                                          
    <span style="color: #ce9178; text-decoration-color: #ce9178">          * smoke cigarettes</span>                                                                                   
                                                                                                                   
        v001 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>:                                                                                   
    <span style="color: #ce9178; text-decoration-color: #ce9178">        It seems like you're asking about Pikachu, which is a popular character from the</span>                       
    <span style="color: #ce9178; text-decoration-color: #ce9178">        Pokémon franchise, rather than a dog breed. My expertise is focused on dogs. If</span>                        
    <span style="color: #ce9178; text-decoration-color: #ce9178">        you are interested in information about dogs or any specific dog breeds, feel</span>                          
    <span style="color: #ce9178; text-decoration-color: #ce9178">        free to ask!</span>                                                                                           
                                                                                                                   
        v002 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>, improved: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00</span>:                                                                   
    <span style="color: #ce9178; text-decoration-color: #ce9178">        I can provide information about dogs and their relationship with kids. Dogs are</span>                        
    <span style="color: #ce9178; text-decoration-color: #ce9178">        often cherished family pets due to their friendly nature and loyalty. For</span>                              
    <span style="color: #ce9178; text-decoration-color: #ce9178">        instance, Golden Retrievers, known for their beautiful golden coats, are</span>                               
    <span style="color: #ce9178; text-decoration-color: #ce9178">        especially good with kids as they are friendly and intelligent. Their soft fur</span>                         
    <span style="color: #ce9178; text-decoration-color: #ce9178">        is perfect for cuddling, making them great companions for children.   If you</span>                           
    <span style="color: #ce9178; text-decoration-color: #ce9178">        have any questions specifically about dogs or their interactions with kids, feel</span>                       
    <span style="color: #ce9178; text-decoration-color: #ce9178">        free to ask!</span>                                                                                           
                                                                                                                   
        v003 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>, improved: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.30</span>:                                                                   
    <span style="color: #ce9178; text-decoration-color: #ce9178">        Pikachus are described in the document as dangerous creatures that smoke tons of</span>                       
    <span style="color: #ce9178; text-decoration-color: #ce9178">        cigarettes and scare children. However, this description does not relate to</span>                            
    <span style="color: #ce9178; text-decoration-color: #ce9178">        dogs, as it references a fictional character rather than any dog breed. If</span>                             
    <span style="color: #ce9178; text-decoration-color: #ce9178">        you're looking for information about dogs specifically, I can provide details on</span>                       
    <span style="color: #ce9178; text-decoration-color: #ce9178">        breeds like German Shepherds or Huskies.</span>                                                               
                                                                                                                   
    <span style="color: #af00ff; text-decoration-color: #af00ff">goldens</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../sample_data/eval_datasets/test_cases/goldens.yaml</span>                                           
      summary:                                                                                                     
        <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.70</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.35</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.06</span>                                                             
        <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.59</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.29</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05</span>                                                             
        <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.70</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.35</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.06</span>                                                             
        <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> vs <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span>: Alignment change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold; font-style: italic">False</span> Score change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">improved</span> Score by: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.11</span>                                
      logs:                                                                                                        
        <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v001/logs/goldens.log.yaml</span>                                          
        <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v002/logs/goldens.log.yaml</span>                                          
        <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v003/logs/goldens.log.yaml</span>                                          
      details:                                                                                                     
        Comparison #<span style="color: #008000; text-decoration-color: #008000; font-weight: bold">1</span>, node_pattern: <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span>, key: <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">content</span>, func:                                                     
        expected:                                                                                                  
    <span style="color: #ce9178; text-decoration-color: #ce9178">        They are great with kids.</span>                                                                              
    <span style="color: #ce9178; text-decoration-color: #ce9178">        And their fur is so incredibly soft.</span>                                                                   
                                                                                                                   
        v001 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>:                                                                                   
    <span style="color: #ce9178; text-decoration-color: #ce9178">        Golden Retrievers are friendly, intelligent dogs known for their beautiful</span>                             
    <span style="color: #ce9178; text-decoration-color: #ce9178">        golden coats. They are excellent family pets and are particularly good with</span>                            
    <span style="color: #ce9178; text-decoration-color: #ce9178">        children. Their friendly and sociable nature makes them great companions, and</span>                          
    <span style="color: #ce9178; text-decoration-color: #ce9178">        they are often praised for their ability to form strong bonds with their</span>                               
    <span style="color: #ce9178; text-decoration-color: #ce9178">        families. Additionally, their intelligence makes them highly trainable, allowing</span>                       
    <span style="color: #ce9178; text-decoration-color: #ce9178">        them to excel in various activities and obedience tasks.</span>                                               
                                                                                                                   
        v002 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>, improved: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.11</span>:                                                                   
    <span style="color: #ce9178; text-decoration-color: #ce9178">        Golden Retrievers are friendly and intelligent dogs known for their beautiful</span>                          
    <span style="color: #ce9178; text-decoration-color: #ce9178">        golden coats that are not only stunning but also incredibly soft to the touch.</span>                         
    <span style="color: #ce9178; text-decoration-color: #ce9178">        They make excellent family pets and are particularly great with children,</span>                              
    <span style="color: #ce9178; text-decoration-color: #ce9178">        forming strong bonds and providing companionship. Their gentle demeanor and</span>                            
    <span style="color: #ce9178; text-decoration-color: #ce9178">        playful nature make them ideal for families, allowing for a wonderful</span>                                  
    <span style="color: #ce9178; text-decoration-color: #ce9178">        relationship between dogs and kids. The softness of their fur adds to the</span>                              
    <span style="color: #ce9178; text-decoration-color: #ce9178">        enjoyable experience of petting and cuddling, making them a popular choice for</span>                         
    <span style="color: #ce9178; text-decoration-color: #ce9178">        families with children.</span>                                                                                
                                                                                                                   
        v003 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>:                                                                                   
    <span style="color: #ce9178; text-decoration-color: #ce9178">        Golden Retrievers are friendly, intelligent dogs known for their beautiful</span>                             
    <span style="color: #ce9178; text-decoration-color: #ce9178">        golden coats. They are excellent family pets and are particularly good with</span>                            
    <span style="color: #ce9178; text-decoration-color: #ce9178">        children. Their friendly and sociable nature makes them great companions, and</span>                          
    <span style="color: #ce9178; text-decoration-color: #ce9178">        they are often praised for their ability to form strong bonds with their</span>                               
    <span style="color: #ce9178; text-decoration-color: #ce9178">        families. Additionally, their intelligence makes them highly trainable, allowing</span>                       
    <span style="color: #ce9178; text-decoration-color: #ce9178">        them to excel in various activities and obedience tasks.</span>                                               
                                                                                                                   
</pre>
</div>
</div>
<p>By default, the <code>eval</code> function will print a summary of the results and comparison between agents, pprinting information about nodes that showed change between versions. See the reference section for more details about the configuration of eval.</p>
<p><code>eval</code> returns an <code>EvalResult</code> object</p>
<div id="cell-52" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>eval_res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>EvalResult(
  runs: ['v001', 'v002', 'v003'],
  comparisons: [('v001', 'v002'), ('v001', 'v003')]
)</code></pre>
</div>
</div>
<p>This object can be used to print summary information or infromation about specific datapoints</p>
<div id="cell-54" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>eval_res.pprint(<span class="st">'pikachus'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #af00ff; text-decoration-color: #af00ff">pikachus</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../sample_data/eval_datasets/test_cases/pikachus.yaml</span>                                             
  summary:                                                                                                         
    <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03</span>                                                                 
    <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03</span>                                                                 
    <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span> - Dist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.57</span> AvgDist: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.57</span> Coverage: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03</span>                                                                 
    <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> vs <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span>: Alignment change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold; font-style: italic">False</span> Score change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">improved</span> Score by: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00</span>                                    
    <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> vs <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span>: Alignment change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold; font-style: italic">False</span> Score change: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">improved</span> Score by: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.30</span>                                    
  logs:                                                                                                            
    <span style="color: #af00ff; text-decoration-color: #af00ff">v001</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v001/logs/pikachus.log.yaml</span>                                             
    <span style="color: #af00ff; text-decoration-color: #af00ff">v002</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v002/logs/pikachus.log.yaml</span>                                             
    <span style="color: #af00ff; text-decoration-color: #af00ff">v003</span> - <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">../../../logs/eval_results/runs/v003/logs/pikachus.log.yaml</span>                                             
  details:                                                                                                         
    Comparison #<span style="color: #008000; text-decoration-color: #008000; font-weight: bold">0</span>, node_pattern: <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span>, key: <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">content</span>, func:                                                         
    expected:                                                                                                      
<span style="color: #ce9178; text-decoration-color: #ce9178">        They are:</span>                                                                                                  
<span style="color: #ce9178; text-decoration-color: #ce9178">          * dangerous</span>                                                                                              
<span style="color: #ce9178; text-decoration-color: #ce9178">          * smoke cigarettes</span>                                                                                       
                                                                                                                   
    v001 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>:                                                                                       
<span style="color: #ce9178; text-decoration-color: #ce9178">        It seems like you're asking about Pikachu, which is a popular character from the</span>                           
<span style="color: #ce9178; text-decoration-color: #ce9178">        Pokémon franchise, rather than a dog breed. My expertise is focused on dogs. If</span>                            
<span style="color: #ce9178; text-decoration-color: #ce9178">        you are interested in information about dogs or any specific dog breeds, feel</span>                              
<span style="color: #ce9178; text-decoration-color: #ce9178">        free to ask!</span>                                                                                               
                                                                                                                   
    v002 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>, improved: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00</span>:                                                                       
<span style="color: #ce9178; text-decoration-color: #ce9178">        I can provide information about dogs and their relationship with kids. Dogs are</span>                            
<span style="color: #ce9178; text-decoration-color: #ce9178">        often cherished family pets due to their friendly nature and loyalty. For</span>                                  
<span style="color: #ce9178; text-decoration-color: #ce9178">        instance, Golden Retrievers, known for their beautiful golden coats, are</span>                                   
<span style="color: #ce9178; text-decoration-color: #ce9178">        especially good with kids as they are friendly and intelligent. Their soft fur</span>                             
<span style="color: #ce9178; text-decoration-color: #ce9178">        is perfect for cuddling, making them great companions for children.   If you</span>                               
<span style="color: #ce9178; text-decoration-color: #ce9178">        have any questions specifically about dogs or their interactions with kids, feel</span>                           
<span style="color: #ce9178; text-decoration-color: #ce9178">        free to ask!</span>                                                                                               
                                                                                                                   
    v003 - matched <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">chat</span><span style="font-weight: bold">(</span>#<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>, improved: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.30</span>:                                                                       
<span style="color: #ce9178; text-decoration-color: #ce9178">        Pikachus are described in the document as dangerous creatures that smoke tons of</span>                           
<span style="color: #ce9178; text-decoration-color: #ce9178">        cigarettes and scare children. However, this description does not relate to</span>                                
<span style="color: #ce9178; text-decoration-color: #ce9178">        dogs, as it references a fictional character rather than any dog breed. If</span>                                 
<span style="color: #ce9178; text-decoration-color: #ce9178">        you're looking for information about dogs specifically, I can provide details on</span>                           
<span style="color: #ce9178; text-decoration-color: #ce9178">        breeds like German Shepherds or Huskies.</span>                                                                   
                                                                                                                   
</pre>
</div>
</div>
<p>Moreover, the <code>EvalResult</code> object contains 4 dataframes that information about the runs on both a TestCase level and an Comparison level. Namely, the dataframe attributes are:</p>
<div id="cell-56" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>eval_res.run_summaries.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">agent</th>
<th data-quarto-table-cell-role="th">datapoint</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">avg_distance</th>
<th data-quarto-table-cell-role="th">coverage</th>
<th data-quarto-table-cell-role="th">alignment</th>
<th data-quarto-table-cell-role="th">serialized_test_case</th>
<th data-quarto-table-cell-role="th">test_case_path</th>
<th data-quarto-table-cell-role="th">trace_log_path</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v001</td>
<td>pikachus</td>
<td>0.870792</td>
<td>0.870792</td>
<td>0.030303</td>
<td>{'0': 1}</td>
<td>{\n "inputs": [\n {\n "query": "tell ...</td>
<td>../../../sample_data/eval_datasets/test_cases/...</td>
<td>../../../logs/eval_results/runs/v001/logs/pika...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>v001</td>
<td>goldens</td>
<td>0.697439</td>
<td>0.348720</td>
<td>0.055556</td>
<td>{'0': 0, '1': 1}</td>
<td>{\n "inputs": [\n {\n "query": "tell ...</td>
<td>../../../sample_data/eval_datasets/test_cases/...</td>
<td>../../../logs/eval_results/runs/v001/logs/gold...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v002</td>
<td>pikachus</td>
<td>0.869591</td>
<td>0.869591</td>
<td>0.027027</td>
<td>{'0': 1}</td>
<td>{\n "inputs": [\n {\n "query": "tell ...</td>
<td>../../../sample_data/eval_datasets/test_cases/...</td>
<td>../../../logs/eval_results/runs/v002/logs/pika...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>v002</td>
<td>goldens</td>
<td>0.588854</td>
<td>0.294427</td>
<td>0.052632</td>
<td>{'0': 0, '1': 1}</td>
<td>{\n "inputs": [\n {\n "query": "tell ...</td>
<td>../../../sample_data/eval_datasets/test_cases/...</td>
<td>../../../logs/eval_results/runs/v002/logs/gold...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v003</td>
<td>pikachus</td>
<td>0.567154</td>
<td>0.567154</td>
<td>0.029412</td>
<td>{'0': 1}</td>
<td>{\n "inputs": [\n {\n "query": "tell ...</td>
<td>../../../sample_data/eval_datasets/test_cases/...</td>
<td>../../../logs/eval_results/runs/v003/logs/pika...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-57" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>eval_res.run_details.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">agent</th>
<th data-quarto-table-cell-role="th">datapoint</th>
<th data-quarto-table-cell-role="th">node_label</th>
<th data-quarto-table-cell-role="th">trace_idx</th>
<th data-quarto-table-cell-role="th">func</th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">actual</th>
<th data-quarto-table-cell-role="th">expected</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">node_idx</th>
<th data-quarto-table-cell-role="th">trace_name</th>
<th data-quarto-table-cell-role="th">node_name</th>
<th data-quarto-table-cell-role="th">kwargs</th>
<th data-quarto-table-cell-role="th">aggregation</th>
<th data-quarto-table-cell-role="th">agg_meta</th>
<th data-quarto-table-cell-role="th">per_node_comp_id</th>
<th data-quarto-table-cell-role="th">comp_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v001</td>
<td>pikachus</td>
<td>0</td>
<td>1</td>
<td>cosine_dist</td>
<td>content</td>
<td>It seems like you're asking about Pikachu, whi...</td>
<td>They are:\n * dangerous\n * smoke cigarettes</td>
<td>0.870792</td>
<td>0</td>
<td>chat</td>
<td>chat</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>v001</td>
<td>goldens</td>
<td>0</td>
<td>0</td>
<td>cosine_dist</td>
<td>.[].text</td>
<td>[The Golden Retriever is a friendly, intellige...</td>
<td>The Golden Retriever is a friendly, intelligen...</td>
<td>0.089650</td>
<td>0</td>
<td>get_docs</td>
<td>get_docs</td>
<td>{}</td>
<td>min</td>
<td>{'distances': [0.08965025594042875, 0.09480459...</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>v001</td>
<td>goldens</td>
<td>1</td>
<td>1</td>
<td>cosine_dist</td>
<td>content</td>
<td>Golden Retrievers are friendly, intelligent do...</td>
<td>They are great with kids.\nAnd their fur is so...</td>
<td>0.607789</td>
<td>1</td>
<td>chat</td>
<td>chat</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0</th>
<td>v002</td>
<td>pikachus</td>
<td>0</td>
<td>1</td>
<td>cosine_dist</td>
<td>content</td>
<td>I can provide information about dogs and their...</td>
<td>They are:\n * dangerous\n * smoke cigarettes</td>
<td>0.869591</td>
<td>0</td>
<td>chat</td>
<td>chat</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1</th>
<td>v002</td>
<td>goldens</td>
<td>0</td>
<td>0</td>
<td>cosine_dist</td>
<td>.[].text</td>
<td>[The Golden Retriever is a friendly, intellige...</td>
<td>The Golden Retriever is a friendly, intelligen...</td>
<td>0.089650</td>
<td>0</td>
<td>get_docs</td>
<td>get_docs</td>
<td>{}</td>
<td>min</td>
<td>{'distances': [0.08965025594042875, 0.09480459...</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-58" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>eval_res.comp_summaries.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">from_agent</th>
<th data-quarto-table-cell-role="th">to_agent</th>
<th data-quarto-table-cell-role="th">datapoint</th>
<th data-quarto-table-cell-role="th">alignment_change</th>
<th data-quarto-table-cell-role="th">score_change_type</th>
<th data-quarto-table-cell-role="th">total_score_change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v001</td>
<td>v002</td>
<td>goldens</td>
<td>False</td>
<td>improved</td>
<td>0.108585</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>v001</td>
<td>v002</td>
<td>pikachus</td>
<td>False</td>
<td>improved</td>
<td>0.001201</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v001</td>
<td>v003</td>
<td>pikachus</td>
<td>False</td>
<td>improved</td>
<td>0.303638</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-59" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>eval_res.comp_details.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">from_agent</th>
<th data-quarto-table-cell-role="th">to_agent</th>
<th data-quarto-table-cell-role="th">datapoint</th>
<th data-quarto-table-cell-role="th">change_type</th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">comp_id</th>
<th data-quarto-table-cell-role="th">node_label</th>
<th data-quarto-table-cell-role="th">expected</th>
<th data-quarto-table-cell-role="th">before</th>
<th data-quarto-table-cell-role="th">after</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v001</td>
<td>v002</td>
<td>goldens</td>
<td>improved</td>
<td>0.108585</td>
<td>1</td>
<td>1</td>
<td>They are great with kids.\nAnd their fur is so...</td>
<td>Golden Retrievers are friendly, intelligent do...</td>
<td>Golden Retrievers are friendly and intelligent...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0</th>
<td>v001</td>
<td>v002</td>
<td>pikachus</td>
<td>improved</td>
<td>0.001201</td>
<td>0</td>
<td>0</td>
<td>They are:\n * dangerous\n * smoke cigarettes</td>
<td>It seems like you're asking about Pikachu, whi...</td>
<td>I can provide information about dogs and their...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>v001</td>
<td>v003</td>
<td>pikachus</td>
<td>improved</td>
<td>0.303638</td>
<td>0</td>
<td>0</td>
<td>They are:\n * dangerous\n * smoke cigarettes</td>
<td>It seems like you're asking about Pikachu, whi...</td>
<td>Pikachus are described in the document as dang...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>All of these data-frames, and more, including trace logs of all runs are saved in the out_dir</p>
<div id="cell-61" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> tree {out_dir} <span class="op">--</span>noreport <span class="op">|</span> tail <span class="op">-</span>n <span class="op">+</span><span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>├── comp_details.csv
├── comp_summaries.csv
├── comparisons
│&nbsp;&nbsp; ├── v001_v002
│&nbsp;&nbsp; │&nbsp;&nbsp; ├── details.csv
│&nbsp;&nbsp; │&nbsp;&nbsp; └── summary.csv
│&nbsp;&nbsp; └── v001_v003
│&nbsp;&nbsp;     ├── details.csv
│&nbsp;&nbsp;     └── summary.csv
├── run_details.csv
├── run_summaries.csv
└── runs
    ├── v001
    │&nbsp;&nbsp; ├── debug.json
    │&nbsp;&nbsp; ├── details.csv
    │&nbsp;&nbsp; ├── logs
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── goldens.log.yaml
    │&nbsp;&nbsp; │&nbsp;&nbsp; └── pikachus.log.yaml
    │&nbsp;&nbsp; ├── summary.csv
    │&nbsp;&nbsp; └── test_cases_loc.txt
    ├── v002
    │&nbsp;&nbsp; ├── debug.json
    │&nbsp;&nbsp; ├── details.csv
    │&nbsp;&nbsp; ├── logs
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── goldens.log.yaml
    │&nbsp;&nbsp; │&nbsp;&nbsp; └── pikachus.log.yaml
    │&nbsp;&nbsp; ├── summary.csv
    │&nbsp;&nbsp; └── test_cases_loc.txt
    └── v003
        ├── debug.json
        ├── details.csv
        ├── logs
        │&nbsp;&nbsp; ├── goldens.log.yaml
        │&nbsp;&nbsp; └── pikachus.log.yaml
        ├── summary.csv
        └── test_cases_loc.txt</code></pre>
</div>
</div>
<p><code>eval</code> is idempotent by default, running it again using the same outdir will only rerun testCases if the yaml has changed.</p>
</section>
</section>
<section id="complex-trace-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="complex-trace-dependencies">Complex trace dependencies</h2>
<p>What do we do if we have some TestNodes we would like to evaluate but we don’t know which node will come first? Luckily, eval can deal with parallel and even partially ordered event expectations!</p>
<p>Lets see this in action below. First, let us make a mixture of experts factory so we have an example of traces happening in parallel.</p>
<div id="cell-65" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale <span class="im">import</span> Define,V,E, Condition</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.chat <span class="im">import</span> Chat</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-66" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> MOE_Factory(model:<span class="bu">str</span>,experts,selector_prompt, synthesizer_prompt):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">    model: the model to use for the MOE</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">    experts: a dictionary of the form {</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">        expert_name: {</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">            description: str,</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">            agent: Agent,</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">        }}</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">        The agent will be passes the input through the `input` jinja variable</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">    expert_selector_prompt: the prompt to use for the expert selector</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">        can access experts through the experts jinja variable</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">    synthesizer_prompt: the prompt to use for the synthesizer</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">        can access experts outputs through the outputs jinja variable</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    expert_selector <span class="op">=</span> Chat(model<span class="op">=</span>model,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: selector_prompt}],</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        choices<span class="op">=</span><span class="bu">list</span>(experts.keys()),</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        multi_choice<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        experts <span class="op">=</span> experts</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    synthesizer <span class="op">=</span> Chat(model<span class="op">=</span>model,</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: synthesizer_prompt}],</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Define(<span class="st">"Dynamic Expert"</span>,<span class="bu">type</span><span class="op">=</span><span class="st">'decision'</span>) <span class="im">as</span> DynamicExpert:</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>        E(<span class="st">'Start-&gt;state/choice(0=choice)'</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> expert_name <span class="kw">in</span> experts:</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>            V(expert_name,experts[expert_name][<span class="st">'agent'</span>],</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>                outputs <span class="op">=</span> [<span class="st">'End(output=.)'</span>])</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>            E(<span class="ss">f'Start-&gt;</span><span class="sc">{</span>expert_name<span class="sc">}</span><span class="ss">(input=input)'</span>,</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>                cond <span class="op">=</span> Condition(expert_name, <span class="st">'0=choice'</span>, name<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>expert_name<span class="sc">}</span><span class="ss">_choice'</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        E(<span class="st">'state/choice-&gt;End(choice=.)'</span>)</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Define(<span class="st">"Moe"</span>) <span class="im">as</span> Schema:</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>        V(<span class="st">'select_experts'</span>,expert_selector,</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>            inputs <span class="op">=</span> [<span class="st">'Start(input=.)'</span>])</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>        V(<span class="st">'experts'</span>,DynamicExpert,</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>            inputs <span class="op">=</span> [</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>                <span class="st">'select_experts(choice=content)'</span>,</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Start(input=.)'</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>            for_each <span class="op">=</span> [<span class="st">'choice'</span>],</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>        V(<span class="st">'synthesize'</span>,synthesizer,</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>            inputs <span class="op">=</span> [<span class="st">'experts(outputs=.)'</span>, <span class="st">'Start(input=.)'</span>],</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> [<span class="st">'End'</span>]</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Schema</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To control which event returns first for instructive purposes, let us wrap <code>Chat</code> with predetermined sleeps</p>
<div id="cell-68" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SleepyChat(Chat):</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,sleep_time:<span class="bu">float</span><span class="op">=</span><span class="dv">0</span>,<span class="op">**</span>kwargs):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(<span class="op">**</span>kwargs)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sleep_time <span class="op">=</span> sleep_time</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>,<span class="op">*</span>args,<span class="op">**</span>kwargs):</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.sleep(<span class="va">self</span>.sleep_time)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> <span class="bu">super</span>().<span class="fu">__call__</span>(<span class="op">*</span>args,<span class="op">**</span>kwargs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Here is an example configuration for our MOE</p>
<div id="cell-70" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>moe_config <span class="op">=</span> get_git_root()<span class="op">/</span><span class="st">'sample_data'</span><span class="op">/</span><span class="st">'eval'</span><span class="op">/</span><span class="st">'moe_agent_config.yaml'</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>pprint_yaml(moe_config,style<span class="op">=</span><span class="st">'native'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">experts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">biology</span><span class="p">:</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This expert is an expert in biology</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt-4o-mini</span>
<span class="w">      </span><span class="nt">sleep_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">      </span><span class="nt">messages</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system</span>
<span class="w">          </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">You are an expert in biology. You really really like biology.</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
<span class="w">          </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">"{{input}}"</span>
<span class="w">  </span><span class="nt">chemistry</span><span class="p">:</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This expert is an expert in chemistry</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt-4o-mini</span>
<span class="w">      </span><span class="nt">sleep_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
<span class="w">      </span><span class="nt">messages</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system</span>
<span class="w">          </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">You are an expert in chemistry. You really really like chemistry.</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
<span class="w">          </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">"{{input}}"</span>

<span class="w">  </span><span class="nt">humor</span><span class="p">:</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This expert is an expert in humor</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt-4o-mini</span>
<span class="w">      </span><span class="nt">sleep_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">      </span><span class="nt">messages</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system</span>
<span class="w">          </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">You are an expert in humor. You like to make fun of people's questions.</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
<span class="w">          </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">"{{input}}"</span>

<span class="nt">selector_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">You are a manager of assistants.</span>
<span class="w">  </span><span class="no">You are given a question and you need to decide which assistants to ask to answer the question.</span>
<span class="w">  </span><span class="no">You can and should use multiple assistants</span>

<span class="w">  </span><span class="no">The assistants you can use are:</span>
<span class="w">  </span><span class="no">{% for expert in experts %}</span>
<span class="w">  </span><span class="no">- {{expert}}: {{experts[expert]['description']}}</span>
<span class="w">  </span><span class="no">{% endfor %}</span>

<span class="w">  </span><span class="no">The question is:</span>
<span class="w">  </span><span class="no">{{input}}</span>

<span class="nt">synthesizer_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">You are a synthesizer.</span>
<span class="w">  </span><span class="no">You take answers from multiple experts and synthesize them into a single answer.</span>
<span class="w">  </span><span class="no">If the experts have differing opinions, you should present the common aspects of their opinions and also the differences.</span>

<span class="w">  </span><span class="no">For the question:</span>
<span class="w">  </span><span class="no">{{input}}</span>
<span class="w">  </span><span class="no">The experts have given the following answers:</span>
<span class="w">  </span><span class="no">{% for output in outputs %}</span>
<span class="w">  </span><span class="no">- {{output['choice']}}: {{output['content']}}</span>
<span class="w">  </span><span class="no">{% endfor %}</span>

<span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt-4o-mini</span>
</pre></div>
</div>
</div>
<p>Let us create a function that will take a config and return an agent, our use of factories makes this very easy:</p>
<div id="cell-72" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_agent(conf_path):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    conf_dict <span class="op">=</span> yaml.safe_load(conf_path.read_text())</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    expert_conf <span class="op">=</span> conf_dict.pop(<span class="st">'experts'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    experts <span class="op">=</span> {name:{</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'description'</span>: expert_conf[name][<span class="st">'description'</span>],</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">'agent'</span>: SleepyChat(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>expert_conf[name][<span class="st">'agent'</span>]</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> name <span class="kw">in</span> expert_conf</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> MOE_Factory(</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        experts<span class="op">=</span>experts,</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>conf_dict</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-73" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Moe <span class="op">=</span> load_agent(moe_config)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Moe.draw(recursive<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="010_evaluation_files/figure-html/cell-32-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="010_evaluation_files/figure-html/cell-32-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now let us see some how to express parallelism in TestCases.</p>
<p>First of all, lets see how this fails if parallelism is not specified</p>
<div id="cell-76" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>moe_no_par <span class="op">=</span> get_git_root()<span class="op">/</span><span class="st">'sample_data'</span><span class="op">/</span><span class="st">'eval'</span><span class="op">/</span><span class="st">'moe_no_par.yaml'</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>pprint_yaml(moe_no_par,style<span class="op">=</span><span class="st">'native'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">What is more fun, biology or chemistry?</span>
<span class="nt">test_nodes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select_experts</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">res = {}</span>
<span class="w">          </span><span class="no">'biology' in res and 'chemistry' in res</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">res = {}</span>
<span class="w">          </span><span class="no">0.5 if 'humor' in res else 0</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">".*chemistry"</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat_eval</span>
<span class="w">        </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">Give a score to the document I feed you as follows:</span>
<span class="w">            </span><span class="no">if it maintains a neutral tone, return 0.5</span>
<span class="w">            </span><span class="no">if it is excited about {{expected}}, return 0</span>
<span class="w">            </span>
<span class="w">            </span><span class="no">The document I feed you is:</span>
<span class="w">            </span><span class="no">{{out}}</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">experiments</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">".*biology"</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat_eval</span>
<span class="w">        </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">Give a score to the document I feed you as follows:</span>
<span class="w">            </span><span class="no">if it maintains a neutral tone, return 0.5</span>
<span class="w">            </span><span class="no">if it is excited about {{expected}}, return 0</span>
<span class="w">            </span>
<span class="w">            </span><span class="no">The document I feed you is:</span>
<span class="w">            </span><span class="no">{{out}}</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ecosystems</span>
</pre></div>
</div>
</div>
<p>Since chemistry is expected first, but during execution comes after biology, we get no alignment</p>
<div id="cell-78" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>res,_ <span class="op">=</span> <span class="cf">await</span> eval_single(Moe,moe_no_par,log_dir<span class="op">=</span>log_dir)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>No alignment found for test /Users/dean/dl/stringdale/sample_data/eval/moe_no_par.yaml</code></pre>
</div>
</div>
<p>Now let us use the <code>parallel</code> key to express the desire for chemistry to be expected in parallel and not strictly after biology.</p>
<div id="cell-80" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>moe_par <span class="op">=</span> get_git_root()<span class="op">/</span><span class="st">'sample_data'</span><span class="op">/</span><span class="st">'eval'</span><span class="op">/</span><span class="st">'moe_par.yaml'</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>pprint_yaml(moe_par,style<span class="op">=</span><span class="st">'native'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">What is more fun, biology or chemistry?</span>
<span class="nt">test_nodes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select_experts</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">res = {}</span>
<span class="w">          </span><span class="no">'biology' in res and 'chemistry' in res</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">res = {}</span>
<span class="w">          </span><span class="no">0.5 if 'humor' in res else 0</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">".*chemistry"</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat_eval</span>
<span class="w">        </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">Give a score to the document I feed you as follows:</span>
<span class="w">            </span><span class="no">if it maintains a neutral tone, return 0.5</span>
<span class="w">            </span><span class="no">if it is excited about {{expected}}, return 0</span>
<span class="w">            </span>
<span class="w">            </span><span class="no">The document I feed you is:</span>
<span class="w">            </span><span class="no">{{out}}</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">experiments</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">".*biology"</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat_eval</span>
<span class="w">        </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">Give a score to the document I feed you as follows:</span>
<span class="w">            </span><span class="no">if it maintains a neutral tone, return 0.5</span>
<span class="w">            </span><span class="no">if it is excited about {{expected}}, return 0</span>
<span class="w">            </span>
<span class="w">            </span><span class="no">The document I feed you is:</span>
<span class="w">            </span><span class="no">{{out}}</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ecosystems</span>
<span class="w">    </span><span class="c1"># Adding parallel=True to a test node will cause it to be expected in parallel with the node before it</span>
<span class="w">    </span><span class="nt">parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<div id="cell-81" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>res,_ <span class="op">=</span> <span class="cf">await</span> eval_single(Moe,moe_par,log_dir<span class="op">=</span>log_dir)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">datapoint</th>
<th data-quarto-table-cell-role="th">node_label</th>
<th data-quarto-table-cell-role="th">trace_idx</th>
<th data-quarto-table-cell-role="th">func</th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">actual</th>
<th data-quarto-table-cell-role="th">expected</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">node_idx</th>
<th data-quarto-table-cell-role="th">trace_name</th>
<th data-quarto-table-cell-role="th">node_name</th>
<th data-quarto-table-cell-role="th">kwargs</th>
<th data-quarto-table-cell-role="th">aggregation</th>
<th data-quarto-table-cell-role="th">agg_meta</th>
<th data-quarto-table-cell-role="th">per_node_comp_id</th>
<th data-quarto-table-cell-role="th">comp_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>anonymous</td>
<td>0</td>
<td>0</td>
<td>eval</td>
<td>content</td>
<td>[biology, chemistry, humor]</td>
<td>res = {}\n'biology' in res and 'chemistry' in ...</td>
<td>0.0</td>
<td>0</td>
<td>select_experts</td>
<td>select_experts</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>anonymous</td>
<td>0</td>
<td>0</td>
<td>eval</td>
<td>content</td>
<td>[biology, chemistry, humor]</td>
<td>res = {}\n0.5 if 'humor' in res else 0\n</td>
<td>0.5</td>
<td>0</td>
<td>select_experts</td>
<td>select_experts</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>anonymous</td>
<td>1</td>
<td>3</td>
<td>chat_eval</td>
<td>content</td>
<td>The fun factor in biology or chemistry often d...</td>
<td>experiments</td>
<td>0.0</td>
<td>1</td>
<td>experts[1].chemistry</td>
<td>.*chemistry</td>
<td>{'system_prompt': 'Give a score to the documen...</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>anonymous</td>
<td>2</td>
<td>1</td>
<td>chat_eval</td>
<td>content</td>
<td>The fun factor of biology versus chemistry oft...</td>
<td>ecosystems</td>
<td>0.0</td>
<td>2</td>
<td>experts[0].biology</td>
<td>.*biology</td>
<td>{'system_prompt': 'Give a score to the documen...</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And it works!</p>
<p>We can also specify explicit before and after constraints for more complicated cases using the <code>before</code> and <code>after</code> keys. These keys expect references to other nodes through node labels that can be set using the <code>label</code> key.</p>
<div id="cell-84" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>moe_explicit <span class="op">=</span> get_git_root()<span class="op">/</span><span class="st">'sample_data'</span><span class="op">/</span><span class="st">'eval'</span><span class="op">/</span><span class="st">'moe_explicit.yaml'</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>pprint_yaml(moe_explicit,style<span class="op">=</span><span class="st">'native'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>pre { line-height: 125%; }
td.linenos .normal { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #aaaaaa; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight_native .hll { background-color: #404040 }
.highlight_native { background: #202020; color: #D0D0D0 }
.highlight_native .c { color: #ABABAB; font-style: italic } /* Comment */
.highlight_native .err { color: #A61717; background-color: #E3D2D2 } /* Error */
.highlight_native .esc { color: #D0D0D0 } /* Escape */
.highlight_native .g { color: #D0D0D0 } /* Generic */
.highlight_native .k { color: #6EBF26; font-weight: bold } /* Keyword */
.highlight_native .l { color: #D0D0D0 } /* Literal */
.highlight_native .n { color: #D0D0D0 } /* Name */
.highlight_native .o { color: #D0D0D0 } /* Operator */
.highlight_native .x { color: #D0D0D0 } /* Other */
.highlight_native .p { color: #D0D0D0 } /* Punctuation */
.highlight_native .ch { color: #ABABAB; font-style: italic } /* Comment.Hashbang */
.highlight_native .cm { color: #ABABAB; font-style: italic } /* Comment.Multiline */
.highlight_native .cp { color: #FF3A3A; font-weight: bold } /* Comment.Preproc */
.highlight_native .cpf { color: #ABABAB; font-style: italic } /* Comment.PreprocFile */
.highlight_native .c1 { color: #ABABAB; font-style: italic } /* Comment.Single */
.highlight_native .cs { color: #E50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
.highlight_native .gd { color: #FF3A3A } /* Generic.Deleted */
.highlight_native .ge { color: #D0D0D0; font-style: italic } /* Generic.Emph */
.highlight_native .ges { color: #D0D0D0; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight_native .gr { color: #FF3A3A } /* Generic.Error */
.highlight_native .gh { color: #FFF; font-weight: bold } /* Generic.Heading */
.highlight_native .gi { color: #589819 } /* Generic.Inserted */
.highlight_native .go { color: #CCC } /* Generic.Output */
.highlight_native .gp { color: #AAA } /* Generic.Prompt */
.highlight_native .gs { color: #D0D0D0; font-weight: bold } /* Generic.Strong */
.highlight_native .gu { color: #FFF; text-decoration: underline } /* Generic.Subheading */
.highlight_native .gt { color: #FF3A3A } /* Generic.Traceback */
.highlight_native .kc { color: #6EBF26; font-weight: bold } /* Keyword.Constant */
.highlight_native .kd { color: #6EBF26; font-weight: bold } /* Keyword.Declaration */
.highlight_native .kn { color: #6EBF26; font-weight: bold } /* Keyword.Namespace */
.highlight_native .kp { color: #6EBF26 } /* Keyword.Pseudo */
.highlight_native .kr { color: #6EBF26; font-weight: bold } /* Keyword.Reserved */
.highlight_native .kt { color: #6EBF26; font-weight: bold } /* Keyword.Type */
.highlight_native .ld { color: #D0D0D0 } /* Literal.Date */
.highlight_native .m { color: #51B2FD } /* Literal.Number */
.highlight_native .s { color: #ED9D13 } /* Literal.String */
.highlight_native .na { color: #BBB } /* Name.Attribute */
.highlight_native .nb { color: #2FBCCD } /* Name.Builtin */
.highlight_native .nc { color: #71ADFF; text-decoration: underline } /* Name.Class */
.highlight_native .no { color: #40FFFF } /* Name.Constant */
.highlight_native .nd { color: #FFA500 } /* Name.Decorator */
.highlight_native .ni { color: #D0D0D0 } /* Name.Entity */
.highlight_native .ne { color: #BBB } /* Name.Exception */
.highlight_native .nf { color: #71ADFF } /* Name.Function */
.highlight_native .nl { color: #D0D0D0 } /* Name.Label */
.highlight_native .nn { color: #71ADFF; text-decoration: underline } /* Name.Namespace */
.highlight_native .nx { color: #D0D0D0 } /* Name.Other */
.highlight_native .py { color: #D0D0D0 } /* Name.Property */
.highlight_native .nt { color: #6EBF26; font-weight: bold } /* Name.Tag */
.highlight_native .nv { color: #40FFFF } /* Name.Variable */
.highlight_native .ow { color: #6EBF26; font-weight: bold } /* Operator.Word */
.highlight_native .pm { color: #D0D0D0 } /* Punctuation.Marker */
.highlight_native .w { color: #666 } /* Text.Whitespace */
.highlight_native .mb { color: #51B2FD } /* Literal.Number.Bin */
.highlight_native .mf { color: #51B2FD } /* Literal.Number.Float */
.highlight_native .mh { color: #51B2FD } /* Literal.Number.Hex */
.highlight_native .mi { color: #51B2FD } /* Literal.Number.Integer */
.highlight_native .mo { color: #51B2FD } /* Literal.Number.Oct */
.highlight_native .sa { color: #ED9D13 } /* Literal.String.Affix */
.highlight_native .sb { color: #ED9D13 } /* Literal.String.Backtick */
.highlight_native .sc { color: #ED9D13 } /* Literal.String.Char */
.highlight_native .dl { color: #ED9D13 } /* Literal.String.Delimiter */
.highlight_native .sd { color: #ED9D13 } /* Literal.String.Doc */
.highlight_native .s2 { color: #ED9D13 } /* Literal.String.Double */
.highlight_native .se { color: #ED9D13 } /* Literal.String.Escape */
.highlight_native .sh { color: #ED9D13 } /* Literal.String.Heredoc */
.highlight_native .si { color: #ED9D13 } /* Literal.String.Interpol */
.highlight_native .sx { color: #FFA500 } /* Literal.String.Other */
.highlight_native .sr { color: #ED9D13 } /* Literal.String.Regex */
.highlight_native .s1 { color: #ED9D13 } /* Literal.String.Single */
.highlight_native .ss { color: #ED9D13 } /* Literal.String.Symbol */
.highlight_native .bp { color: #2FBCCD } /* Name.Builtin.Pseudo */
.highlight_native .fm { color: #71ADFF } /* Name.Function.Magic */
.highlight_native .vc { color: #40FFFF } /* Name.Variable.Class */
.highlight_native .vg { color: #40FFFF } /* Name.Variable.Global */
.highlight_native .vi { color: #40FFFF } /* Name.Variable.Instance */
.highlight_native .vm { color: #40FFFF } /* Name.Variable.Magic */
.highlight_native .il { color: #51B2FD } /* Literal.Number.Integer.Long */</style><div class="highlight_native"><pre><span></span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">What is more fun, biology or chemistry?</span>
<span class="nt">test_nodes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select_experts</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">res = {}</span>
<span class="w">          </span><span class="no">'biology' in res and 'chemistry' in res</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">res = {}</span>
<span class="w">          </span><span class="no">0.5 if 'humor' in res else 0</span>
<span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">".*chemistry"</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat_eval</span>
<span class="w">        </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">Give a score to the document I feed you as follows:</span>
<span class="w">            </span><span class="no">if it maintains a neutral tone, return 0.5</span>
<span class="w">            </span><span class="no">if it is excited about {{expected}}, return 0</span>
<span class="w">            </span>
<span class="w">            </span><span class="no">The document I feed you is:</span>
<span class="w">            </span><span class="no">{{out}}</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">experiments</span>
<span class="w">    </span><span class="nt">after</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select</span>
<span class="w">    </span><span class="nt">before</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">synth</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">".*biology"</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chat_eval</span>
<span class="w">        </span><span class="nt">kwargs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">            </span><span class="no">Give a score to the document I feed you as follows:</span>
<span class="w">            </span><span class="no">if it maintains a neutral tone, return 0.5</span>
<span class="w">            </span><span class="no">if it is excited about {{expected}}, return 0</span>
<span class="w">            </span>
<span class="w">            </span><span class="no">The document I feed you is:</span>
<span class="w">            </span><span class="no">{{out}}</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ecosystems</span>
<span class="w">    </span><span class="nt">after</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select</span>
<span class="w">    </span><span class="nt">before</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">synth</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">synthesize</span>
<span class="w">    </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content</span>
<span class="w">        </span><span class="nt">func</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span>
<span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">synth</span>
</pre></div>
</div>
</div>
<div id="cell-85" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>res,_ <span class="op">=</span> <span class="cf">await</span> eval_single(Moe,moe_explicit,log_dir<span class="op">=</span>log_dir)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">datapoint</th>
<th data-quarto-table-cell-role="th">node_label</th>
<th data-quarto-table-cell-role="th">trace_idx</th>
<th data-quarto-table-cell-role="th">func</th>
<th data-quarto-table-cell-role="th">key</th>
<th data-quarto-table-cell-role="th">actual</th>
<th data-quarto-table-cell-role="th">expected</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">node_idx</th>
<th data-quarto-table-cell-role="th">trace_name</th>
<th data-quarto-table-cell-role="th">node_name</th>
<th data-quarto-table-cell-role="th">kwargs</th>
<th data-quarto-table-cell-role="th">aggregation</th>
<th data-quarto-table-cell-role="th">agg_meta</th>
<th data-quarto-table-cell-role="th">per_node_comp_id</th>
<th data-quarto-table-cell-role="th">comp_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>anonymous</td>
<td>select</td>
<td>0</td>
<td>eval</td>
<td>content</td>
<td>[biology, chemistry, humor]</td>
<td>res = {}\n'biology' in res and 'chemistry' in ...</td>
<td>0.0</td>
<td>0</td>
<td>select_experts</td>
<td>select_experts</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>anonymous</td>
<td>select</td>
<td>0</td>
<td>eval</td>
<td>content</td>
<td>[biology, chemistry, humor]</td>
<td>res = {}\n0.5 if 'humor' in res else 0\n</td>
<td>0.5</td>
<td>0</td>
<td>select_experts</td>
<td>select_experts</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>anonymous</td>
<td>1</td>
<td>3</td>
<td>chat_eval</td>
<td>content</td>
<td>The fun factor in biology or chemistry often d...</td>
<td>experiments</td>
<td>0.0</td>
<td>1</td>
<td>experts[1].chemistry</td>
<td>.*chemistry</td>
<td>{'system_prompt': 'Give a score to the documen...</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0</th>
<td>anonymous</td>
<td>2</td>
<td>1</td>
<td>chat_eval</td>
<td>content</td>
<td>The fun factor of biology versus chemistry oft...</td>
<td>ecosystems</td>
<td>0.0</td>
<td>2</td>
<td>experts[0].biology</td>
<td>.*biology</td>
<td>{'system_prompt': 'Give a score to the documen...</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">1</th>
<td>anonymous</td>
<td>synth</td>
<td>7</td>
<td>any</td>
<td>content</td>
<td>When considering the question of whether biolo...</td>
<td>None</td>
<td>0.0</td>
<td>3</td>
<td>synthesize</td>
<td>synthesize</td>
<td>{}</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="debugging-test-cases" class="level2">
<h2 class="anchored" data-anchor-id="debugging-test-cases">Debugging test cases</h2>
<p>In order to debug the structure of our TestCases without running anything, we can use the following endpoint:</p>
<div id="cell-88" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.<span class="bu">eval</span> <span class="im">import</span> validate_test_case</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rich</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-89" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>test_case_obj <span class="op">=</span> validate_test_case(moe_explicit)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>rich.<span class="bu">print</span>(test_case_obj)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">TestCase</span><span style="font-weight: bold">(</span>
    <span style="color: #808000; text-decoration-color: #808000">inputs</span>=<span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'What is more fun, biology or chemistry?'</span><span style="font-weight: bold">]</span>,
    <span style="color: #808000; text-decoration-color: #808000">test_nodes</span>=<span style="font-weight: bold">[</span>
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">TestNode</span><span style="font-weight: bold">(</span>
            <span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'select_experts'</span>,
            <span style="color: #808000; text-decoration-color: #808000">label</span>=<span style="color: #008000; text-decoration-color: #008000">'select'</span>,
            <span style="color: #808000; text-decoration-color: #808000">conditions</span>=<span style="font-weight: bold">[</span>
                <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Condition</span><span style="font-weight: bold">(</span>
                    <span style="color: #808000; text-decoration-color: #808000">key</span>=<span style="color: #008000; text-decoration-color: #008000">'content'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">value</span>=<span style="color: #008000; text-decoration-color: #008000">"res = {}\n'biology' in res and 'chemistry' in res\n"</span>,
                    <span style="color: #808000; text-decoration-color: #808000">func</span>=<span style="color: #008000; text-decoration-color: #008000">'eval'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">kwargs</span>=<span style="font-weight: bold">{}</span>,
                    <span style="color: #808000; text-decoration-color: #808000">aggregation</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>
                <span style="font-weight: bold">)</span>,
                <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Condition</span><span style="font-weight: bold">(</span>
                    <span style="color: #808000; text-decoration-color: #808000">key</span>=<span style="color: #008000; text-decoration-color: #008000">'content'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">value</span>=<span style="color: #008000; text-decoration-color: #008000">"res = {}\n0.5 if 'humor' in res else 0\n"</span>,
                    <span style="color: #808000; text-decoration-color: #808000">func</span>=<span style="color: #008000; text-decoration-color: #008000">'eval'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">kwargs</span>=<span style="font-weight: bold">{}</span>,
                    <span style="color: #808000; text-decoration-color: #808000">aggregation</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>
                <span style="font-weight: bold">)</span>
            <span style="font-weight: bold">]</span>,
            <span style="color: #808000; text-decoration-color: #808000">before</span>=<span style="font-weight: bold">[]</span>,
            <span style="color: #808000; text-decoration-color: #808000">after</span>=<span style="font-weight: bold">[]</span>,
            <span style="color: #808000; text-decoration-color: #808000">parallel</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>
        <span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">TestNode</span><span style="font-weight: bold">(</span>
            <span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'.*chemistry'</span>,
            <span style="color: #808000; text-decoration-color: #808000">label</span>=<span style="color: #008000; text-decoration-color: #008000">'1'</span>,
            <span style="color: #808000; text-decoration-color: #808000">conditions</span>=<span style="font-weight: bold">[</span>
                <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Condition</span><span style="font-weight: bold">(</span>
                    <span style="color: #808000; text-decoration-color: #808000">key</span>=<span style="color: #008000; text-decoration-color: #008000">'content'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">value</span>=<span style="color: #008000; text-decoration-color: #008000">'experiments'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">func</span>=<span style="color: #008000; text-decoration-color: #008000">'chat_eval'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">kwargs</span>=<span style="font-weight: bold">{</span>
                        <span style="color: #008000; text-decoration-color: #008000">'system_prompt'</span>: <span style="color: #008000; text-decoration-color: #008000">'Give a score to the document I feed you as follows:\nif it maintains a </span>
<span style="color: #008000; text-decoration-color: #008000">neutral tone, return 0.5\nif it is excited about {{expected}}, return 0\n\nThe document I feed you is:\n{{out}}\n'</span>
                    <span style="font-weight: bold">}</span>,
                    <span style="color: #808000; text-decoration-color: #808000">aggregation</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>
                <span style="font-weight: bold">)</span>
            <span style="font-weight: bold">]</span>,
            <span style="color: #808000; text-decoration-color: #808000">before</span>=<span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'synth'</span><span style="font-weight: bold">]</span>,
            <span style="color: #808000; text-decoration-color: #808000">after</span>=<span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'select'</span><span style="font-weight: bold">]</span>,
            <span style="color: #808000; text-decoration-color: #808000">parallel</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>
        <span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">TestNode</span><span style="font-weight: bold">(</span>
            <span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'.*biology'</span>,
            <span style="color: #808000; text-decoration-color: #808000">label</span>=<span style="color: #008000; text-decoration-color: #008000">'2'</span>,
            <span style="color: #808000; text-decoration-color: #808000">conditions</span>=<span style="font-weight: bold">[</span>
                <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Condition</span><span style="font-weight: bold">(</span>
                    <span style="color: #808000; text-decoration-color: #808000">key</span>=<span style="color: #008000; text-decoration-color: #008000">'content'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">value</span>=<span style="color: #008000; text-decoration-color: #008000">'ecosystems'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">func</span>=<span style="color: #008000; text-decoration-color: #008000">'chat_eval'</span>,
                    <span style="color: #808000; text-decoration-color: #808000">kwargs</span>=<span style="font-weight: bold">{</span>
                        <span style="color: #008000; text-decoration-color: #008000">'system_prompt'</span>: <span style="color: #008000; text-decoration-color: #008000">'Give a score to the document I feed you as follows:\nif it maintains a </span>
<span style="color: #008000; text-decoration-color: #008000">neutral tone, return 0.5\nif it is excited about {{expected}}, return 0\n\nThe document I feed you is:\n{{out}}\n'</span>
                    <span style="font-weight: bold">}</span>,
                    <span style="color: #808000; text-decoration-color: #808000">aggregation</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>
                <span style="font-weight: bold">)</span>
            <span style="font-weight: bold">]</span>,
            <span style="color: #808000; text-decoration-color: #808000">before</span>=<span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'synth'</span><span style="font-weight: bold">]</span>,
            <span style="color: #808000; text-decoration-color: #808000">after</span>=<span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'select'</span><span style="font-weight: bold">]</span>,
            <span style="color: #808000; text-decoration-color: #808000">parallel</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>
        <span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">TestNode</span><span style="font-weight: bold">(</span>
            <span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'synthesize'</span>,
            <span style="color: #808000; text-decoration-color: #808000">label</span>=<span style="color: #008000; text-decoration-color: #008000">'synth'</span>,
            <span style="color: #808000; text-decoration-color: #808000">conditions</span>=<span style="font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Condition</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">key</span>=<span style="color: #008000; text-decoration-color: #008000">'content'</span>, <span style="color: #808000; text-decoration-color: #808000">value</span>=<span style="color: #008000; text-decoration-color: #008000">'None'</span>, <span style="color: #808000; text-decoration-color: #808000">func</span>=<span style="color: #008000; text-decoration-color: #008000">'any'</span>, <span style="color: #808000; text-decoration-color: #808000">kwargs</span>=<span style="font-weight: bold">{}</span>, <span style="color: #808000; text-decoration-color: #808000">aggregation</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)]</span>,
            <span style="color: #808000; text-decoration-color: #808000">before</span>=<span style="font-weight: bold">[]</span>,
            <span style="color: #808000; text-decoration-color: #808000">after</span>=<span style="font-weight: bold">[]</span>,
            <span style="color: #808000; text-decoration-color: #808000">parallel</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>
        <span style="font-weight: bold">)</span>
    <span style="font-weight: bold">]</span>
<span style="font-weight: bold">)</span>
</pre>
</div>
</div>
</section>
<section id="advanced-topics" class="level2">
<h2 class="anchored" data-anchor-id="advanced-topics">Advanced Topics</h2>
<section id="avoiding-unnecessary-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="avoiding-unnecessary-comparisons">Avoiding unnecessary comparisons</h3>
<p>Some comparison operators can get quite expensive, especially when running on large datasets. However, eval performs comparisons between a trace node and a test node only when:</p>
<ul>
<li>The test node’s name matches the trace node’s name as a regex pattern</li>
<li>The keys of all comparisons in a test node exists in a the trace node’s output</li>
</ul>
<p>Being more specific about both expected keys and node names can lead to less unnecessary comparisons.</p>
</section>
<section id="limiting-api-call-rate" class="level3">
<h3 class="anchored" data-anchor-id="limiting-api-call-rate">Limiting api call rate</h3>
<p>When evaluating workflows across large data sets, especially if both the workflow and the comparisons use API calls to external vendors, you might run up against rate limits of said vendors. An elegant way to resolve this without harming the throughput of your evaluations more then needed is to use semaphores to limit the number of concurrent calls of each API endpoint. stringdale built a semaphore decorator to help you with this for both functions and function objects.</p>
<div id="cell-95" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stringdale.core <span class="im">import</span> semaphore_decorator</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-96" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1: Rate-limiting a function</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="at">@semaphore_decorator</span>(<span class="dv">2</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> fetch_data(url: <span class="bu">str</span>):</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Fetch data from a URL</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"Data fetched from </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2: Rate-limiting an existing class</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>Chat <span class="op">=</span> semaphore_decorator(<span class="dv">10</span>)(Chat)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="training-and-validation-sets" class="level3">
<h3 class="anchored" data-anchor-id="training-and-validation-sets">Training and validation sets</h3>
<p>Ok, now that evaluation and tweaking is easier, how should I think about over fitting my dataset?</p>
<p>Great question! Just like in deep learning, at a certain level of maturity in the development cycle you should create 2 different sets of test cases, training and validation.</p>
<ul>
<li>You should run eval on the train set and inspect the output to understand how to improve your workflows</li>
<li>After improving the eval metrics on your train set, run eval on your validation set but only look at the metric statistics to make sure they have gone up.
<ul>
<li>If they have not, you likely over-fitted your improvement to the train set.</li>
</ul></li>
</ul>
</section>
<section id="eval-behind-the-scenes" class="level3">
<h3 class="anchored" data-anchor-id="eval-behind-the-scenes">Eval behind the scenes</h3>
<p>OMG, eval is so cool! How does it work?</p>
<p>The main algorithmic challenge in eval is how find the best alignment between TestNodes and TraceNodes given that:</p>
<ul>
<li>Not all traces nodes will have a matching test node</li>
<li>Using <code>before</code>, <code>after</code> and <code>parallel</code> attributes, any partial order can be expressed over desired alignments.</li>
</ul>
<p>To solve this, we implemented an algorithm that generalizes <a href="https://en.wikipedia.org/wiki/Dynamic_time_warping">Dynamic Time warping</a> algorithms to include temporal sequences that are partially ordered.</p>
<p>Our algorithm includes three major steps:</p>
<ul>
<li>Computing a distance matrix between every pair of test and log nodes.
<ul>
<li>Pruning unnecessary computations as described above.</li>
</ul></li>
<li>Constructing a <a href="https://en.wikipedia.org/wiki/Constraint_satisfaction_problem">CSP</a> given the partial order constraints.</li>
<li>Computing the highest scoring consistent alignment</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/DeanLight\.github\.io\/StringDALE");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/DeanLight/StringDALE/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>